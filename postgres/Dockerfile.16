FROM postgres:16-bullseye
ARG APT_PROXY_IP
ARG APT_OPTIONS
CMD ["postgres"]
RUN echo "Acquire::http::Proxy \"http://${APT_PROXY_IP}:3142\";" > /etc/apt/apt.conf.d/01proxy
RUN apt update && \
apt $APT_OPTIONS \
install -y postgresql-server-dev-16 python-dev build-essential git python3-pip procps sockstat
RUN apt $APT_OPTIONS install -y postgresql-16-postgis-3


ADD config* /
ADD run.sh /run.sh
COPY init/* /docker-entrypoint-initdb.d/
RUN chown -R postgres:postgres /docker-entrypoint-initdb.d && \
    chmod a+x /docker-entrypoint-initdb.d/*.sh /run.sh
