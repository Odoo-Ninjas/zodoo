ARG USE_APT_MIRRORS
ENV USE_APT_MIRRORS=$USE_APT_MIRRORS
# mirror list: https://gist.github.com/swetoast/32d382fc714f1bda0850bfe09d0cb09e
# get the best nearby mirror:
# curl -s https://gist.githubusercontent.com/swetoast/32d382fc714f1bda0850bfe09d0cb09e/raw/f946fdee8b2d88792d9410b1b69eace15bb9e55c/gistfile1.txt | xargs -n1 -I {} sh -c 'echo `curl -r 0-102400 -s -w %{speed_download} -o /dev/null {}/ls-lR.gz` {}' |sort -g -r |head -1| awk '{ print $2  }' xargs: warning: options --max-args and --replace/-I/-i are mutually exclusive, ignoring previous --max-args value
RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    if [ "$USE_APT_MIRRORS" = "1" ]; then \
        find /etc/apt/sources.list /etc/apt/sources.list.d/ -type f -print0 | \
        xargs -0 -I{} bash -c ' \
            sed -i "s|http://archive.ubuntu.com/ubuntu|http://de.archive.ubuntu.com/ubuntu|g" "$1"; \
            sed -i "s|http://ports.ubuntu.com/ubuntu-ports|http://ftp.tu-chemnitz.de/pub/linux/ubuntu-ports|g" "$1"; \
            sed -i "s|http://security.ubuntu.com/ubuntu|http://ftp.halifax.rwth-aachen.de/ubuntu|g" "$1"; \
            sed -i "s|http://deb.debian.org/debian-security|http://security.debian.org/debian-security|g" "$1"; \
            sed -i "s|http://deb.debian.org/debian|http://ftp.halifax.rwth-aachen.de/debian|g" "$1"; \
        ' _ {}; \
    fi
RUN apt-get update
# RUN apt-get install -y --reinstall ubuntu-keyring || apt-get install -y --reinstall debian-archive-keyring
